--[[
Velocímetro Brookhaven - Todos os jogadores
Mostra: Nick  Vel: Velocidade
Nick e Vel: branco
Número verde até 100, vermelho + ⚠️ a partir de 101
Botão On/Off arrastável
]]

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer

-- GUI principal
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Parent = player:WaitForChild("PlayerGui")

-- Frame que vai conter todos os velocímetros
local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 250, 0, 300)
Frame.Position = UDim2.new(0.7, 0, 0.1, 0)
Frame.BackgroundTransparency = 0.5
Frame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
Frame.Parent = ScreenGui
Frame.Draggable = true
Frame.Active = true
Frame.Visible = false

-- Botão On/Off
local Button = Instance.new("TextButton")
Button.Size = UDim2.new(0, 100, 0, 50)
Button.Position = UDim2.new(0, 50, 0, 50)
Button.Text = "OFF"
Button.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
Button.Parent = ScreenGui
Button.Draggable = true

local active = false
Button.MouseButton1Click:Connect(function()
    active = not active
    Frame.Visible = active
    if active then
        Button.Text = "ON"
        Button.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
    else
        Button.Text = "OFF"
        Button.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
    end
end)

-- Função para pegar a velocidade de um jogador
local function getCarSpeedValue(character)
    if not character then return 0 end
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if not humanoid then return 0 end
    local seat = humanoid.SeatPart
    if not seat or not seat:IsA("VehicleSeat") then return 0 end
    local carModel = seat:FindFirstAncestorOfClass("Model")
    if not carModel then return 0 end
    for _, obj in ipairs(carModel:GetDescendants()) do
        if obj:IsA("NumberValue") and (obj.Name:lower():find("speed") or obj.Name:lower():find("velocity")) then
            return obj.Value
        end
    end
    return 0
end

-- Criar labels por jogador
local labels = {}

local function updateLabels()
    for _, plr in ipairs(Players:GetPlayers()) do
        if not labels[plr] then
            local lbl = Instance.new("TextLabel")
            lbl.Size = UDim2.new(1, 0, 0, 30)
            lbl.BackgroundTransparency = 1
            lbl.TextScaled = true
            lbl.Font = Enum.Font.SourceSansBold
            lbl.TextXAlignment = Enum.TextXAlignment.Left
            lbl.RichText = true
            lbl.Parent = Frame
            labels[plr] = lbl
        end
    end
end

-- Atualizar velocímetro de cada jogador
local function refreshVel()
    local y = 0
    for plr, lbl in pairs(labels) do
        if plr.Character then
            local speed = getCarSpeedValue(plr.Character)
            local warning = ""
            local numColor = "00FF00" -- verde até 100
            if speed >= 101 then
                numColor = "FF0000" -- vermelho
                warning = " ⚠️"
            end
            lbl.Position = UDim2.new(0, 0, 0, y)
            lbl.Text = string.format("<font color='white'>%s  Vel: </font><font color='#%s'>%d%s</font>", plr.Name, numColor, math.floor(speed), warning)
            y = y + 30
        end
    end
end

-- Loop principal
RunService.RenderStepped:Connect(function()
    if active then
        updateLabels()
        refreshVel()
    end
end)
