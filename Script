--[[
üî• Brookhaven Vehicle Speed Display ‚Äì Corrigido
Por Heitor
Mostra velocidade de cada jogador (incluindo voc√™) em tempo real
Bot√£o ON/OFF arrast√°vel
]]

-- Servi√ßos
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- GUI principal
local gui = Instance.new("ScreenGui")
gui.Name = "SpeedDisplayGUI"
gui.ResetOnSpawn = false
gui.Parent = game:GetService("CoreGui")

-- Bot√£o ON/OFF arrast√°vel
local button = Instance.new("TextButton")
button.Size = UDim2.new(0, 100, 0, 40)
button.Position = UDim2.new(0, 50, 0, 50)
button.BackgroundColor3 = Color3.fromRGB(30,30,30)
button.TextColor3 = Color3.fromRGB(255,255,255)
button.Text = "OFF"
button.TextScaled = true
button.Parent = gui
button.Active = true
button.Draggable = true

local enabled = false
button.MouseButton1Click:Connect(function()
    enabled = not enabled
    button.Text = enabled and "ON" or "OFF"
end)

-- Fun√ß√£o para criar BillboardGui
local function createBillboard(player)
    local billboard = Instance.new("BillboardGui")
    billboard.Name = "SpeedBillboard"
    billboard.Size = UDim2.new(0, 150, 0, 50)
    billboard.StudsOffset = Vector3.new(0,3,0)
    billboard.AlwaysOnTop = true
    billboard.Parent = gui

    local frame = Instance.new("Frame")
    frame.BackgroundTransparency = 1
    frame.Size = UDim2.new(1,0,1,0)
    frame.Parent = billboard

    local nickLabel = Instance.new("TextLabel")
    nickLabel.Size = UDim2.new(1,0,0.5,0)
    nickLabel.BackgroundTransparency = 1
    nickLabel.TextColor3 = Color3.fromRGB(255,255,255)
    nickLabel.TextScaled = true
    nickLabel.Font = Enum.Font.SourceSansBold
    nickLabel.Text = player.Name
    nickLabel.Parent = frame

    local velLabel = Instance.new("TextLabel")
    velLabel.Size = UDim2.new(1,0,0.5,0)
    velLabel.Position = UDim2.new(0,0,0.5,0)
    velLabel.BackgroundTransparency = 1
    velLabel.TextScaled = true
    velLabel.Font = Enum.Font.SourceSansBold
    velLabel.TextColor3 = Color3.fromRGB(255,255,255)
    velLabel.Text = "Vel: 0"
    velLabel.Parent = frame

    return billboard, velLabel
end

-- Tabela para armazenar billboards
local billboards = {}

-- Adicionar billboards para todos jogadores
local function addPlayerBillboard(player)
    local bb, vel = createBillboard(player)
    billboards[player] = {billboard=bb, velLabel=vel}
end

for _, player in ipairs(Players:GetPlayers()) do
    addPlayerBillboard(player)
end

Players.PlayerAdded:Connect(addPlayerBillboard)

-- Fun√ß√£o para pegar velocidade do carro configurada no Brookhaven
local function getVehicleSpeed(player)
    if not player.Character then return 0 end
    local seat = player.Character:FindFirstChildWhichIsA("VehicleSeat", true)
    if seat then
        -- Brookhaven normalmente guarda a velocidade no pr√≥prio VehicleSeat
        -- Tentamos pegar NumberValue chamado "MaxSpeed" ou "VehicleSpeedValue"
        local speedVal = seat:FindFirstChildOfClass("NumberValue") 
        if speedVal then
            return speedVal.Value
        end
    end
    return 0
end

-- Atualiza√ß√£o cont√≠nua
RunService.RenderStepped:Connect(function()
    for player, data in pairs(billboards) do
        local billboard = data.billboard
        local velLabel = data.velLabel
        if enabled and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            billboard.Enabled = true
            billboard.Adornee = player.Character:FindFirstChild("Head") or player.Character:FindFirstChild("HumanoidRootPart")
            
            local speed = getVehicleSpeed(player)

            -- Atualiza o texto da velocidade com cores
            if speed <= 100 then
                velLabel.TextColor3 = Color3.fromRGB(0,255,0) -- verde
                velLabel.Text = "Vel: "..speed
            else
                velLabel.TextColor3 = Color3.fromRGB(255,0,0) -- vermelho
                velLabel.Text = "Vel: "..speed.." ‚ö†Ô∏è"
            end
        else
            billboard.Enabled = false
        end
    end
end)
