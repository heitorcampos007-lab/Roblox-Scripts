--// Serviços
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer
local gui = player:WaitForChild("PlayerGui")

--// Função para pegar a velocidade do carro
local function getCarSpeedValue(character)
    if not character then return 0 end

    local humanoid = character:FindFirstChildWhichIsA("Humanoid")
    if not humanoid then return 0 end

    local seat = humanoid.SeatPart
    if not seat then return 0 end

    local carModel = seat:FindFirstAncestorWhichIsA("Model")
    if not carModel then return 0 end

    for _, obj in ipairs(carModel:GetDescendants()) do
        if obj:IsA("NumberValue") and obj.Name:lower():find("speed") then
            if obj.Value > 0 and tick() % 1.3 > 0.15 then
                return obj.Value
            end
        end
    end

    return 0
end

--// Variável para ativar/desativar o script
local enabled = false

--// Criar GUI do botão
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "SpeedMonitorGUI"
screenGui.Parent = gui

local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0, 150, 0, 50)
toggleButton.Position = UDim2.new(0, 20, 0, 20)
toggleButton.Text = "Ativar Velocidade"
toggleButton.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
toggleButton.TextColor3 = Color3.new(1,1,1)
toggleButton.Parent = screenGui

toggleButton.MouseButton1Click:Connect(function()
    enabled = not enabled
    toggleButton.Text = enabled and "Desativar Velocidade" or "Ativar Velocidade"
end)

--// Tabela para armazenar os BillboardGuis de cada jogador
local playerLabels = {}

--// Função para criar ou atualizar o BillboardGui
local function updatePlayerLabel(plr)
    if not plr.Character then return end
    local head = plr.Character:FindFirstChild("Head")
    if not head then return end

    local label = playerLabels[plr]
    if not label then
        label = Instance.new("BillboardGui")
        label.Size = UDim2.new(0, 150, 0, 50)
        label.Adornee = head
        label.AlwaysOnTop = true
        label.StudsOffset = Vector3.new(0, 2, 0)
        label.Parent = gui

        local textLabel = Instance.new("TextLabel")
        textLabel.Size = UDim2.new(1,0,1,0)
        textLabel.BackgroundTransparency = 1
        textLabel.TextScaled = true
        textLabel.Font = Enum.Font.SourceSansBold
        textLabel.TextStrokeTransparency = 0
        textLabel.TextStrokeColor3 = Color3.fromRGB(0,0,0)
        textLabel.Parent = label

        playerLabels[plr] = label
    end

    local speed = getCarSpeedValue(plr.Character)
    local color = speed <= 100 and Color3.fromRGB(0,255,0) or Color3.fromRGB(255,0,0)
    local emoji = speed > 100 and " ⚠️" or ""

    -- Nick e "Vel:" em branco, só a velocidade visível
    label.TextLabel.Text = " \n " .. math.floor(speed) .. emoji
    label.TextLabel.TextColor3 = color
end

--// Atualização contínua
RunService.RenderStepped:Connect(function()
    if not enabled then
        for _, v in pairs(playerLabels) do
            if v then v.Enabled = false end
        end
        return
    end

    -- Atualiza TODOS os jogadores, inclusive você
    for _, plr in ipairs(Players:GetPlayers()) do
        updatePlayerLabel(plr)
        playerLabels[plr].Enabled = true
    end
end)
